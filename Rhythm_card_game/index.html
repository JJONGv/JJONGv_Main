<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¦¬ë“¬ ì¹´ë“œ ê²Œì„ v2</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Inter í°íŠ¸ (Tailwindì˜ ê¸°ë³¸ í°íŠ¸) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Tailwind CSSì˜ ê¸°ë³¸ 'font-sans'ëŠ” 'Inter'ë¥¼ í¬í•¨í•œ ì‹œìŠ¤í…œ í°íŠ¸ ëª©ë¡ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
          ì—¬ê¸°ì„œëŠ” ëª…ì‹œì ìœ¼ë¡œ Interë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
        */
        body {
            font-family: 'Inter', sans-serif;
            /* ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ */
            scroll-behavior: smooth;
        }

        /* 3D ì¹´ë“œ ë’¤ì§‘ê¸° íš¨ê³¼ë¥¼ ìœ„í•œ ì»¤ìŠ¤í…€ CSS */
        
        /* .perspective: 3D íš¨ê³¼ë¥¼ ìœ„í•œ ë¶€ëª¨ ì»¨í…Œì´ë„ˆ */
        .perspective {
            perspective: 1000px;
        }

        /* .transform-style-preserve-3d: ìì‹ ìš”ì†Œì˜ 3D ë³€í˜•ì„ ìœ ì§€ */
        .transform-style-preserve-3d {
            transform-style: preserve-3d;
        }

        /* .card-face: ì¹´ë“œì˜ ì•ë©´ê³¼ ë’·ë©´ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .card-face {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden; /* Safari í˜¸í™˜ì„± */
        }

        /* .rotate-y-180: Yì¶•ìœ¼ë¡œ 180ë„ íšŒì „ (ì¹´ë“œ ë’·ë©´) */
        .rotate-y-180 {
            transform: rotateY(180deg);
        }

        /* .flipped: 'flipped' í´ë˜ìŠ¤ê°€ ì¶”ê°€ë  ë•Œì˜ ì¹´ë“œ íšŒì „ */
        .flipped {
            transform: rotateY(180deg);
        }

        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” (ëª¨ë‹¬ ë‚´ë¶€ìš©) */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(33, 128, 141, 0.6); /* --color-teal-500ì˜ 60% */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(29, 116, 128, 1); /* --color-teal-600 */
        }

        /* ë‹¤í¬ ëª¨ë“œì—ì„œì˜ ìŠ¤í¬ë¡¤ë°” */
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(50, 184, 198, 0.6); /* --color-teal-300ì˜ 60% */
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(50, 184, 198, 1); /* --color-teal-300 */
        }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 text-slate-900 dark:text-slate-200 min-h-screen p-4 sm:p-8 transition-colors duration-300">

    <div class="container max-w-7xl mx-auto">
        
        <header class="text-center mb-8 sm:mb-12">
            <h1 class="text-3xl sm:text-4xl font-bold text-teal-600 dark:text-teal-400">
                ğŸµ ë¦¬ë“¬ ì¹´ë“œ ë±
            </h1>
            <p class="text-lg text-slate-600 dark:text-slate-400 mt-2">
                ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ ë’¤ì§‘ê³ , ë¦¬ë“¬ì„ í™•ì¸í•´ë³´ì„¸ìš”.
            </p>
        </header>

        <!-- ì¹´ë“œ ê·¸ë¦¬ë“œ -->
        <div id="cardsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 sm:gap-6">
            <!-- ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>

        <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
        <div class="controls flex justify-center items-center gap-4 my-8 sm:my-12">
            <button id="shuffleButton" class="flex items-center gap-2 px-5 py-3 rounded-lg font-semibold text-white bg-teal-600 hover:bg-teal-700 shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-0.5">
                <!-- Heroicons: shuffle -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10 3a1 1 0 011 1v1.158l3.243-3.242a1 1 0 111.414 1.414L12.414 5.586V10a1 1 0 11-2 0V5.586L7.172 8.828a1 1 0 11-1.414-1.414L9 4.158V4a1 1 0 011-1zM3 10a1 1 0 011 1v1.158l3.243-3.242a1 1 0 111.414 1.414L5.414 13.586V18a1 1 0 11-2 0v-4.414l-3.243 3.242a1 1 0 11-1.414-1.414L3 12.158V11a1 1 0 010-1zM10 12a1 1 0 011 1v1.158l3.243-3.242a1 1 0 111.414 1.414L12.414 15.586V20a1 1 0 11-2 0v-4.414l-3.243 3.242a1 1 0 11-1.414-1.414L9 14.158V13a1 1 0 011-1zM17 3a1 1 0 011 1v1.158l-3.243 3.242a1 1 0 11-1.414-1.414L16.586 4H12a1 1 0 110-2h5a1 1 0 011 1z" />
                </svg>
                ì¹´ë“œ ì„ê¸°
            </button>
            <button id="resetButton" class="flex items-center gap-2 px-5 py-3 rounded-lg font-semibold text-slate-700 dark:text-slate-200 bg-white dark:bg-slate-700 hover:bg-slate-50 dark:hover:bg-slate-600 border border-slate-300 dark:border-slate-600 shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-0.5">
                <!-- Heroicons: refresh -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.004 14a1 1 0 01.997.997A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 111.885-.666A5.002 5.002 0 005.001 17a1 1 0 01-.997-.997z" clip-rule="evenodd" />
                </svg>
                ì´ˆê¸°í™”
            </button>
        </div>
        
    </div>

    <!-- ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 opacity-0 invisible transition-all duration-300 ease-in-out" role="dialog" aria-modal="true">
        
        <!-- ëª¨ë‹¬ ì»¨í…ì¸  -->
        <div id="modal-content" class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-11/12 relative transform scale-95 transition-all duration-300 ease-in-out max-h-[90vh] flex flex-col">
            
            <!-- ëª¨ë‹¬ í—¤ë” -->
            <header class="p-6 border-b border-slate-200 dark:border-slate-700">
                <h2 id="modal-title" class="text-2xl font-semibold text-teal-600 dark:text-teal-400">
                    <!-- ëª¨ë‹¬ ì œëª©ì´ ì—¬ê¸°ì— ì‚½ì…ë©ë‹ˆë‹¤ -->
                </h2>
            </header>

            <!-- ëª¨ë‹¬ ë°”ë”” (ìŠ¤í¬ë¡¤ ì—†ìŒ, ê°€ìš´ë° ì •ë ¬) -->
            <div id="modal-body" class="p-6 sm:p-8 flex-grow flex items-center justify-center overflow-hidden">
                <!-- ë¦¬ë“¬ íŒ¨í„´ì´ ì—¬ê¸°ì— ì‚½ì…ë©ë‹ˆë‹¤ -->
            </div>
            
            <!-- ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ -->
            <button id="modal-close-btn" class="absolute top-4 right-4 text-slate-500 dark:text-slate-400 hover:text-red-500 dark:hover:text-red-400 transition-colors" aria-label="ëª¨ë‹¬ ë‹«ê¸°">
                <!-- Heroicons: x-circle -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
    </div>


    <script>
        // --- ë°ì´í„° ---
        // ì›ë³¸ ë°ì´í„° êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë˜, Tailwind í´ë˜ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ê¸° í¸í•˜ë„ë¡ color í•„ë“œ ì¶”ê°€
        const originalCardsData = [
            { id: 1, title: 'ì¹´ë“œ 1', colorHex: '#E57373', color: 'red-500', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™©'] },
            { id: 2, title: 'ì¹´ë“œ 2', colorHex: '#81C784', color: 'green-500', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™ª', 'â™ª'] },
            { id: 3, title: 'ì¹´ë“œ 3', colorHex: '#64B5F6', color: 'blue-500', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™ª'] },
            { id: 4, title: 'ì¹´ë“œ 4', colorHex: '#FFD54F', color: 'yellow-500', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™©'] },
            { id: 5, title: 'ì¹´ë“œ 5', colorHex: '#BA68C8', color: 'purple-500', rhythm: ['â™©', 'â™©', 'â™©', 'â™©'] },
            { id: 6, title: 'ì¹´ë“œ 6', colorHex: '#4DB6AC', color: 'teal-500', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™©', 'â™ª', 'â™ª'] },
            { id: 7, title: 'ì¹´ë“œ 7', colorHex: '#FF8A65', color: 'orange-500', rhythm: ['â™©', 'â™©', 'â™©', 'â™ª', 'â™ª'] },
            { id: 8, title: 'ì¹´ë“œ 8', colorHex: '#90CAF9', color: 'sky-500', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™©', 'â™ª', 'â™ª'] },
            { id: 9, title: 'ì¹´ë“œ 9', colorHex: '#A5D6A7', color: 'lime-500', rhythm: ['â™©', 'â™©', 'â™ª', 'â™ª', 'â™©'] },
            { id: 10, title: 'ì¹´ë“œ 10', colorHex: '#CE93D8', color: 'fuchsia-500', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™ª'] },
            { id: 11, title: 'ì¹´ë“œ 11', colorHex: '#FFAB91', color: 'red-400', rhythm: ['â™©', 'â™©', 'â™ª', 'â™ª', 'â™ª', 'â™ª'] },
            { id: 12, title: 'ì¹´ë“œ 12', colorHex: '#80DEEA', color: 'cyan-500', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™©'] },
            { id: 13, title: 'ì¹´ë“œ 13', colorHex: '#BCAAA4', color: 'stone-500', rhythm: ['â™©', 'â™©', 'â™©', 'â™©', 'â™©'] },
            { id: 14, title: 'ì¹´ë“œ 14', colorHex: '#EF9A9A', color: 'rose-500', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™©', 'â™©'] },
            { id: 15, title: 'ì¹´ë“œ 15', colorHex: '#F48FB1', color: 'pink-500', rhythm: ['â™©', 'â™©', 'â™©', 'â™ª', 'â™ª', 'â™©'] },
            { id: 16, title: 'ì¹´ë“œ 16', colorHex: '#9FA8DA', color: 'indigo-500', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™©', 'â™©'] },
            { id: 17, title: 'ì¹´ë“œ 17', colorHex: '#80CBC4', color: 'emerald-500', rhythm: ['â™©', 'â™©', 'â™ª', 'â™ª', 'â™©', 'â™ª', 'â™ª'] },
            { id: 18, title: 'ì¹´ë“œ 18', colorHex: '#C5E1A5', color: 'lime-400', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™©', 'â™ª', 'â™ª', 'â™©'] },
            { id: 19, title: 'ì¹´ë“œ 19', colorHex: '#FFE082', color: 'amber-500', rhythm: ['â™©', 'â™©', 'â™©', 'â™©', 'â™ª', 'â™ª'] },
            { id: 20, title: 'ì¹´ë“œ 20', colorHex: '#FFCCBC', color: 'orange-400', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™©', 'â™©', 'â™©'] },
            { id: 21, title: 'ì¹´ë“œ 21', colorHex: '#B39DDB', color: 'violet-500', rhythm: ['â™©', 'â™©', 'â™ª', 'â™ª', 'â™©', 'â™©'] },
            { id: 22, title: 'ì¹´ë“œ 22', colorHex: '#81D4FA', color: 'sky-400', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™©', 'â™ª', 'â™ª', 'â™©'] },
            { id: 23, title: 'ì¹´ë“œ 23', colorHex: '#A1887F', color: 'neutral-500', rhythm: ['â™©', 'â™©', 'â™©', 'â™ª', 'â™ª', 'â™ª', 'â™ª'] },
            { id: 24, title: 'ì¹´ë“œ 24', colorHex: '#E57373', color: 'red-500', rhythm: ['â™©', 'â™ª', 'â™ª', 'â™ª', 'â™ª', 'â™©', 'â™©', 'â™©'] },
            { id: 25, title: 'ì¹´ë“œ 25', colorHex: '#F06292', color: 'pink-600', rhythm: ['â™©', 'ğ„½', 'â™©', 'ğ„½'] },
            { id: 26, title: 'ì¹´ë“œ 26', colorHex: '#7986CB', color: 'indigo-400', rhythm: ['â™©', 'â™ª', 'â™ª', 'ğ„½', 'â™©'] },
            { id: 27, title: 'ì¹´ë“œ 27', colorHex: '#4DD0E1', color: 'cyan-400', rhythm: ['ğ„½', 'â™©', 'â™©', 'â™©'] },
            { id: 28, title: 'ì¹´ë“œ 28', colorHex: '#AED581', color: 'lime-400', rhythm: ['â™©', 'ğ„½', 'â™ª', 'â™ª', 'â™©'] },
            { id: 29, title: 'ì¹´ë“œ 29', colorHex: '#FFB74D', color: 'orange-400', rhythm: ['â™©', 'â™©', 'ğ„½', 'â™©'] },
            { id: 30, title: 'ì¹´ë“œ 30', colorHex: '#A1887F', color: 'neutral-500', rhythm: ['ğ„½', 'â™ª', 'â™ª', 'â™©', 'â™ª', 'â™ª'] }
        ];

        let currentCardsData = [...originalCardsData];
        let flippedCardId = null;
        let modalResizeObserver = null; // To track the observer
        let currentModalCardData = null; // To pass data to the resize function

        // --- DOM ìš”ì†Œ ---
        const cardsGrid = document.getElementById('cardsGrid');
        const shuffleButton = document.getElementById('shuffleButton');
        const resetButton = document.getElementById('resetButton');
        
        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        // --- í•¨ìˆ˜ ---

        /**
         * ì¹´ë“œ ë’·ë©´ì˜ ë¦¬ë“¬ íŒ¨í„´ HTMLì„ ìƒì„±í•©ë‹ˆë‹¤. (ì‘ì€ ë²„ì „)
         */
        function createRhythmPattern(rhythm, color) {
            const notesHTML = rhythm.map(note => `
                <div class="w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center rounded-lg text-2xl font-semibold border-2 border-${color} text-${color} bg-${color}/10">
                    ${note}
                </div>
            `).join('');
            
            return `<div class="flex flex-wrap justify-center items-center gap-2">${notesHTML}</div>`;
        }

        /**
         * ëª¨ë‹¬ì— í‘œì‹œë  ë¦¬ë“¬ íŒ¨í„´ HTMLì„ ìƒì„±í•©ë‹ˆë‹¤. (í° ë²„ì „)
         */
        function createModalRhythmPattern(rhythm, color) {
            const notesHTML = rhythm.map(note => `
                <div class="modal-note flex-shrink-0 flex items-center justify-center rounded-lg font-semibold border-2 border-${color} text-${color} bg-${color}/10" style="transition: width 0.15s ease-out, height 0.15s ease-out, font-size 0.15s ease-out;">
                    ${note}
                </div>
            `).join('');
            
            // JSê°€ í¬ê¸°ë¥¼ ê³„ì‚°í•˜ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” inline-flexë¡œ í•œ ì¤„ ì •ë ¬ë§Œ ë³´ì¥í•©ë‹ˆë‹¤.
            return `<div id="modal-rhythm-container" class="inline-flex flex-nowrap items-center">${notesHTML}</div>`;
        }

        /**
         * ê°œë³„ ì¹´ë“œì˜ DOM ìš”ì†Œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
         */
        function createCard(cardData) {
            const { id, title, colorHex, color, rhythm } = cardData;

            // ì¹´ë“œ ì»¨í…Œì´ë„ˆ
            const cardContainer = document.createElement('div');
            cardContainer.className = 'perspective w-full h-40 sm:h-48 rounded-xl';
            cardContainer.dataset.id = id;

            // ì¹´ë“œ ë’¤ì§‘ê¸° ë˜í¼
            const cardInner = document.createElement('div');
            cardInner.id = `card-${id}`;
            cardInner.className = 'card-inner relative w-full h-full transform-style-preserve-3d transition-transform duration-700 ease-in-out';

            // ì¹´ë“œ ì•ë©´
            const cardFront = document.createElement('div');
            cardFront.className = 'card-face absolute w-full h-full rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 flex flex-col items-center justify-center p-4 text-white cursor-pointer';
            // ê·¸ë¼ë°ì´ì…˜ì„ ìœ„í•´ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì‚¬ìš©
            cardFront.style.background = `linear-gradient(135deg, ${colorHex} 0%, ${colorHex}dd 100%)`;
            cardFront.innerHTML = `
                <h2 class="text-xl sm:text-2xl font-semibold">${title}</h2>
                <p class="text-sm opacity-90 mt-1">í´ë¦­í•˜ì—¬ ë’¤ì§‘ê¸°</p>
            `;

            // ì¹´ë“œ ë’·ë©´
            const cardBack = document.createElement('div');
            cardBack.className = 'card-face absolute w-full h-full rounded-xl shadow-lg bg-white dark:bg-slate-800 p-4 flex flex-col items-center justify-center rotate-y-180 cursor-pointer';
            
            cardBack.innerHTML = `
                <h3 class="text-lg font-semibold text-${color} dark:text-${color}">${title}</h3>
                <div class="my-2 scale-75 sm:scale-100">
                    ${createRhythmPattern(rhythm, color)}
                </div>
                <button class="expand-btn mt-2 px-3 py-1 text-xs sm:text-sm font-medium rounded-full bg-${color}/10 text-${color} hover:bg-${color}/20 transition-colors">
                    í¬ê²Œ ë³´ê¸°
                </button>
            `;

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            cardContainer.addEventListener('click', () => flipCard(id));

            const expandBtn = cardBack.querySelector('.expand-btn');
            expandBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // ë¶€ëª¨(ì¹´ë“œ ì»¨í…Œì´ë„ˆ)ì˜ flipCard ì´ë²¤íŠ¸ ë°©ì§€
                openModal(cardData);
            });

            cardInner.appendChild(cardFront);
            cardInner.appendChild(cardBack);
            cardContainer.appendChild(cardInner);

            return cardContainer;
        }

        /**
         * ëª¨ë‹¬ì— í‘œì‹œëœ ìŒí‘œ/ì‰¼í‘œì˜ í¬ê¸°ë¥¼ ë™ì ìœ¼ë¡œ ê³„ì‚°í•˜ê³  ì ìš©í•©ë‹ˆë‹¤.
         */
        function resizeModalNotes() {
            if (!currentModalCardData || !modalBody) return;

            const container = document.getElementById('modal-rhythm-container');
            if (!container) return;

            const notes = container.querySelectorAll('.modal-note');
            const numNotes = notes.length;
            if (numNotes === 0) return;

            // 1. ì‚¬ìš© ê°€ëŠ¥í•œ ê°€ë¡œí­ ê³„ì‚° (ì¢Œìš° íŒ¨ë”© ì œì™¸)
            const padding = window.innerWidth < 640 ? 48 : 64; // p-6 (3rem) or p-8 (4rem)
            const availableWidth = modalBody.clientWidth - padding; // ì¢Œìš° íŒ¨ë”©ì„ ëº€ ì‹¤ì œ ê°€ìš© ë„ˆë¹„

            // 2. í¬ê¸° ì œì•½ ì¡°ê±´ ì •ì˜
            const maxNoteSize = window.innerWidth < 1024 ? 96 : 112; // md:w-24 or lg:w-28
            const minNoteSize = 40; 
            const maxGap = 16; 
            const minGap = 4;
            
            // 3. ì´ìƒì ì¸ ìŒí‘œ í¬ê¸° ê³„ì‚° (ë¹„ìœ¨ì„ 0.15 (15%)ë¡œ ê°€ì •)
            // availableWidth = (noteSize * numNotes) + (gap * (numNotes - 1))
            // gap = noteSize * 0.15
            let idealNoteSize = availableWidth / (numNotes + (0.15 * (numNotes - 1)));

            // 4. ê³„ì‚°ëœ í¬ê¸°ë¥¼ ìµœëŒ€/ìµœì†Œ ì‚¬ì´ë¡œ ì œí•œ
            let calculatedSize = Math.max(minNoteSize, Math.min(maxNoteSize, idealNoteSize));
            let calculatedGap = Math.max(minGap, Math.min(maxGap, calculatedSize * 0.15));

            // 5. ì˜ˆì™¸ ì²˜ë¦¬: ìµœì†Œ í¬ê¸°ë¡œë„ í•œ ì¤„ì— ë“¤ì–´ê°€ì§€ ëª»í•˜ëŠ” ê²½ìš°
            const minRequiredWidth = (minNoteSize * numNotes) + (minGap * (numNotes - 1));
            
            if (availableWidth < minRequiredWidth) {
                // í•œ ì¤„ì— ë¶ˆê°€ëŠ¥: ê°€ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” ë° ìµœì†Œ í¬ê¸° ì ìš©
                modalBody.classList.remove('overflow-hidden', 'justify-center');
                modalBody.classList.add('overflow-x-auto', 'justify-start');
                calculatedSize = minNoteSize; // ìŠ¤í¬ë¡¤ ì‹œ ìµœì†Œ í¬ê¸° ì‚¬ìš©
                calculatedGap = minGap;
            } else {
                // í•œ ì¤„ì— ê°€ëŠ¥: ê°€ìš´ë° ì •ë ¬ ë° overflow ìˆ¨ê¹€
                modalBody.classList.add('overflow-hidden', 'justify-center');
                modalBody.classList.remove('overflow-x-auto', 'justify-start');
            }

            // 6. ê³„ì‚°ëœ ìŠ¤íƒ€ì¼ ì ìš©
            const calculatedFontSize = calculatedSize * 0.6; // ë°•ìŠ¤ í¬ê¸°ì˜ 60%
            
            container.style.gap = `${calculatedGap}px`;
            notes.forEach(note => {
                note.style.width = `${calculatedSize}px`;
                note.style.height = `${calculatedSize}px`;
                note.style.fontSize = `${calculatedFontSize}px`;
            });
        }

        /**
         * ëª¨ë‹¬ì„ ì—½ë‹ˆë‹¤.
         */
        function openModal(cardData) {
            const { title, rhythm, color } = cardData;
            
            currentModalCardData = cardData; // ë¦¬ì‚¬ì´ì¦ˆë¥¼ ìœ„í•´ í˜„ì¬ ì¹´ë“œ ë°ì´í„° ì €ì¥
            
            modalTitle.textContent = `ğŸµ ${title} ë¦¬ë“¬ íŒ¨í„´`;
            modalBody.innerHTML = createModalRhythmPattern(rhythm, color);
            
            // ëª¨ë‹¬ì„ í‘œì‹œí•˜ê¸° *ì „ì—* í¬ê¸° ê³„ì‚°ì„ í•œ ë²ˆ ì‹¤í–‰
            resizeModalNotes(); 

            modalOverlay.classList.remove('invisible', 'opacity-0');
            modalContent.classList.remove('scale-95');

            // ëª¨ë‹¬ì´ ì—´ë¦° í›„, modalBodyì˜ í¬ê¸° ë³€ê²½ì„ ê°ì§€í•˜ëŠ” Observer ì—°ê²°
            if (modalResizeObserver) {
                modalResizeObserver.disconnect();
            }
            modalResizeObserver = new ResizeObserver(resizeModalNotes);
            modalResizeObserver.observe(modalBody);
        }

        /**
         * ëª¨ë‹¬ì„ ë‹«ìŠµë‹ˆë‹¤.
         */
        function closeModal() {
            modalOverlay.classList.add('opacity-0');
            modalContent.classList.add('scale-95');
            
            // ResizeObserver ì—°ê²° í•´ì œ
            if (modalResizeObserver) {
                modalResizeObserver.disconnect();
                modalResizeObserver = null;
            }
            currentModalCardData = null; // í˜„ì¬ ì¹´ë“œ ë°ì´í„° ì§€ìš°ê¸°
            
            // ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚œ í›„ invisible ì¶”ê°€
            setTimeout(() => {
                modalOverlay.classList.add('invisible');
            }, 300); // transition-duration-300
        }

        /**
         * ì¹´ë“œ ê·¸ë¦¬ë“œë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤. (ì• ë‹ˆë©”ì´ì…˜ í¬í•¨)
         */
        function renderCards(cards) {
            cardsGrid.innerHTML = ''; // ê·¸ë¦¬ë“œ ë¹„ìš°ê¸°
            flippedCardId = null; // ë’¤ì§‘íŒ ì¹´ë“œ ìƒíƒœ ì´ˆê¸°í™”
            
            cards.forEach((cardData, index) => {
                const card = createCard(cardData);
                card.style.opacity = '0'; // ì´ˆê¸° íˆ¬ëª…ë„
                card.style.transform = 'translateY(20px)'; // ì´ˆê¸° ìœ„ì¹˜
                cardsGrid.appendChild(card);

                // ìŠ¤íƒœê±° ì• ë‹ˆë©”ì´ì…˜ (ìˆœì°¨ì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ê¸°)
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                    card.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                }, index * 50); // 50ms ê°„ê²©
            });
        }

        /**
         * ì¹´ë“œë¥¼ ë’¤ì§‘ìŠµë‹ˆë‹¤.
         */
        function flipCard(id) {
            const cardInner = document.getElementById(`card-${id}`);
            if (!cardInner) return;

            // ì´ë¯¸ ë‹¤ë¥¸ ì¹´ë“œê°€ ë’¤ì§‘í˜€ìˆìœ¼ë©´, ê·¸ ì¹´ë“œë¥¼ ë¨¼ì € ì›ìƒë³µêµ¬
            if (flippedCardId && flippedCardId !== id) {
                const prevFlippedCard = document.getElementById(`card-${flippedCardId}`);
                if (prevFlippedCard) {
                    prevFlippedCard.classList.remove('flipped');
                }
            }

            // í˜„ì¬ ì¹´ë“œ ìƒíƒœ í† ê¸€
            if (flippedCardId === id) {
                // ì´ë¯¸ ë’¤ì§‘íŒ ì¹´ë“œë¥¼ ë‹¤ì‹œ í´ë¦­ (ì›ìƒë³µêµ¬)
                cardInner.classList.remove('flipped');
                flippedCardId = null;
            } else {
                // ìƒˆ ì¹´ë“œ ë’¤ì§‘ê¸°
                cardInner.classList.add('flipped');
                flippedCardId = id;
            }
        }

        /**
         * ì¹´ë“œë¥¼ ì„ìŠµë‹ˆë‹¤.
         */
        function shuffleCards() {
            if (flippedCardId) {
                flipCard(flippedCardId); // ë’¤ì§‘íŒ ì¹´ë“œ ì›ìƒë³µêµ¬
            }
            closeModal(); // ëª¨ë‹¬ ë‹«ê¸°
            
            // Fisher-Yates ì…”í”Œ
            let shuffled = [...originalCardsData];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            currentCardsData = shuffled;
            renderCards(currentCardsData);
        }

        /**
         * ì¹´ë“œë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.
         */
        function resetCards() {
            if (flippedCardId) {
                flipCard(flippedCardId); // ë’¤ì§‘íŒ ì¹´ë“œ ì›ìƒë³µêµ¬
            }
            closeModal(); // ëª¨ë‹¬ ë‹«ê¸°

            currentCardsData = [...originalCardsData];
            renderCards(currentCardsData);
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” ---
        shuffleButton.addEventListener('click', shuffleCards);
        resetButton.addEventListener('click', resetCards);
        
        modalCloseBtn.addEventListener('click', closeModal);
        modalOverlay.addEventListener('click', (e) => {
            // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸° (ì»¨í…ì¸  ì˜ì—­ ì œì™¸)
            if (e.target === modalOverlay) {
                closeModal();
            }
        });

        // Escape í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !modalOverlay.classList.contains('invisible')) {
                closeModal();
            }
        });

        // --- ì´ˆê¸° ì‹¤í–‰ ---
        renderCards(currentCardsData);
        
    </script>

</body>
</html>




